!function(e,t){"function"==typeof define&&define.amd?define("postmonger",[],function(){return t(e)}):"object"==typeof exports?module.exports=t(e):e.Postmonger=t(e)}(this,function(e){var t="1.0.0",n=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n in t){var o=t[n];o.configurable=!0,o.value&&(o.writable=!0),Object.defineProperty(e,n,o)}}var r=n(function(e){this.eventObject={},this.eventId=1,this.readyQueue=[],this.messageQueue=[],this.connection=e,this.connected=!1,this.debug=!1,this.channelId="",this.onMessageReceived=this.onMessageReceived.bind(this),e.addEventListener("message",this.onMessageReceived)},{on:function(e,t){this.eventObject[e]||(this.eventObject[e]=[]),this.eventObject[e].push(t)},off:function(e,t){if(this.eventObject[e]){var n=this.eventObject[e].indexOf(t);n>=0&&this.eventObject[e].splice(n,1)}},trigger:function(e){var t=this,n=Array.prototype.slice.call(arguments,1);this.eventObject[e]&&this.eventObject[e].forEach(function(e){e.apply(t,n)})},onMessageReceived:function(e){if(this.connected||"handshake"===e.data.type){if(this.debug&&console.log("received message",e.data),"handshake"===e.data.type)this.connected=!0,this.trigger("ready"),this.channelId=e.data.channelId,this.readyQueue.forEach(function(e){this.postMessage(e.topic,e.data)},this),this.readyQueue=[];else{var t=e.data.topic;this.trigger(t,e.data.data)}}}});return{Session:r}});
